# Story for the Syrian assassins
# originally made by Petter Vilberg
# adjusted by me

story_jabalid_invasion = {
	on_setup = {
		historicinvasions_story_setup_effect = { # global start variable, story variables, conditional dissolution protection
			INVADER_DYNN = jabalid # for story start global variable
			INVADER_TITLE = title:k_jabalid # title the invader spawns with
		}
		story_owner = {
			jabalid_maintenance_effect = {
				INVADER_DYNN = jabalid
				INVADER_CHAR = scope:story.story_owner
				INVADER_TITLE = scope:story.var:invader_title_var
				LANDLESS_YES_NO = no
				STARTING_TIER = county
			}
		}
	}

	on_end = {
		invader_story_on_end_effect = { INVADER_DYNN = jabalid }
	}

	on_owner_death = {
		# random chance to set variable to end story after ruler N dies, depending on how many story owners there have been in total
		random = {
			chance = 0
			modifier = {
				add = 100
				var:story_owner_counter >= 1 # end story after death of ruler N?
			}
			set_variable = {
				name = end_of_invasion_story
				value = yes
			}
		}
		invader_story_on_death_effect = { INVADER_DYNN = jabalid }
	}

	# maintenance
	effect_group = {
		days = historicinvasions_story_maintenance_value

		trigger = { always = yes }

		# end the story prematurely, because the invader has lost their #th offensive war
		triggered_effect = {
			trigger = {
				NOT = { has_game_rule = historicinvasions_invasion_ends_after_defeat_disabled }
			}
			effect = {
				historicinvasions_invasion_ends_after_defeat_effect = yes
			}
		}
	}

	### end story
	# this story is currently only an empty shell
	effect_group = {
		days = 365
		trigger = { always = yes }
		triggered_effect = {
			trigger = {
				story_owner = {
					is_landless_ruler = no
					is_at_war = no
				}
			}
			effect = { end_story = yes }
		}
	}
}